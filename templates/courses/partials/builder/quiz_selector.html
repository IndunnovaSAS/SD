{% comment %}
Quiz selector partial for assigning assessments to quiz-type lessons.
Context: lesson, course, module, available_assessments (optional), new_assessment (optional)
{% endcomment %}

<div class="p-3 bg-base-200 rounded-lg" x-data="{ showCreateQuiz: false }">
    <h5 class="text-xs font-semibold mb-2">Asignar Evaluacion</h5>

    <!-- Select existing assessment -->
    <form hx-post="{% url 'courses:builder_assign_quiz' course.id module.id lesson.id %}"
          hx-target="closest [data-lesson-id]"
          hx-swap="outerHTML">
        {% csrf_token %}
        <div class="flex gap-2 items-end">
            <div class="form-control flex-1">
                <select name="assessment_id" class="select select-bordered select-xs w-full">
                    <option value="">-- Sin evaluacion --</option>
                    {% for assessment in available_assessments %}
                    <option value="{{ assessment.id }}"
                            {% if lesson.assessments.first and lesson.assessments.first.id == assessment.id %}selected{% endif %}>
                        {{ assessment.title }} ({{ assessment.get_assessment_type_display }})
                    </option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-primary btn-xs">Asignar</button>
        </div>
    </form>

    <div class="divider my-2 text-xs">o</div>

    <!-- Create new quiz -->
    <button class="btn btn-ghost btn-xs w-full" @click="showCreateQuiz = !showCreateQuiz"
            x-show="!showCreateQuiz">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Crear nueva evaluacion
    </button>

    <div x-show="showCreateQuiz" x-cloak x-transition>
        {% include "courses/partials/builder/quiz_inline_form.html" with course=course %}
    </div>
</div>
