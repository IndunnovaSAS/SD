<div id="course-progress-render" style="width:100%;height:100%;min-height:320px;"></div>
<script>
(function() {
    function init() {
        var el = document.getElementById('course-progress-render');
        if (!el || typeof echarts === 'undefined') return;
        var chart = echarts.init(el);

        var names = [{% for c in courses %}'{{ c.title|truncatechars:25 }}'{% if not forloop.last %},{% endif %}{% endfor %}];
        var completed = [{% for c in courses %}{{ c.total_completed }}{% if not forloop.last %},{% endif %}{% endfor %}];
        var inProgress = [{% for c in courses %}{{ c.total_in_progress }}{% if not forloop.last %},{% endif %}{% endfor %}];

        if (names.length === 0) {
            names = ['Sin cursos'];
            completed = [0];
            inProgress = [0];
        }

        chart.setOption({
            tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
            legend: { bottom: 0, textStyle: { fontSize: 11 } },
            grid: { left: '3%', right: '4%', bottom: '12%', top: '3%', containLabel: true },
            xAxis: { type: 'value', minInterval: 1 },
            yAxis: { type: 'category', data: names, axisLabel: { fontSize: 10 } },
            series: [
                {
                    name: 'Completados',
                    type: 'bar',
                    stack: 'total',
                    data: completed,
                    itemStyle: { color: '#22c55e', borderRadius: [0, 0, 0, 0] },
                    emphasis: { focus: 'series' }
                },
                {
                    name: 'En Progreso',
                    type: 'bar',
                    stack: 'total',
                    data: inProgress,
                    itemStyle: { color: '#3b82f6', borderRadius: [0, 4, 4, 0] },
                    emphasis: { focus: 'series' }
                }
            ]
        });
        window.addEventListener('resize', function() { chart.resize(); });
    }
    if (typeof echarts !== 'undefined') { init(); }
    else { document.addEventListener('echarts:ready', init); }
})();
</script>
