<div id="compliance-chart-render" style="width:100%;height:100%;min-height:220px;"></div>
<script>
(function() {
    function init() {
        var el = document.getElementById('compliance-chart-render');
        if (!el || typeof echarts === 'undefined') return;
        var chart = echarts.init(el);

        var completed = {{ chart_data.completed }};
        var inProgress = {{ chart_data.in_progress }};
        var notStarted = {{ chart_data.not_started }};
        var expired = {{ chart_data.expired }};
        var total = completed + inProgress + notStarted + expired;

        var option = {
            tooltip: { trigger: 'item', formatter: '{b}: {c} ({d}%)' },
            legend: { bottom: 0, left: 'center', textStyle: { fontSize: 11 } },
            series: [{
                name: 'Cumplimiento',
                type: 'pie',
                radius: ['40%', '70%'],
                center: ['50%', '45%'],
                avoidLabelOverlap: false,
                itemStyle: { borderRadius: 10, borderColor: '#fff', borderWidth: 2 },
                label: {
                    show: total === 0,
                    position: 'center',
                    formatter: total === 0 ? 'Sin datos' : '',
                    fontSize: 14,
                    color: '#94a3b8'
                },
                emphasis: { label: { show: true, fontSize: 18, fontWeight: 'bold' } },
                labelLine: { show: false },
                data: total === 0 ? [
                    { value: 1, name: 'Sin datos', itemStyle: { color: '#e2e8f0' } }
                ] : [
                    { value: completed, name: 'Completados', itemStyle: { color: '#22c55e' } },
                    { value: inProgress, name: 'En Progreso', itemStyle: { color: '#3b82f6' } },
                    { value: notStarted, name: 'Sin Iniciar', itemStyle: { color: '#94a3b8' } },
                    { value: expired, name: 'Vencidos', itemStyle: { color: '#ef4444' } }
                ]
            }]
        };

        chart.setOption(option);
        window.addEventListener('resize', function() { chart.resize(); });
    }
    if (typeof echarts !== 'undefined') { init(); }
    else { document.addEventListener('echarts:ready', init); }
})();
</script>
