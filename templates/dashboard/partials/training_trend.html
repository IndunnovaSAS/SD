<div id="training-trend-render" style="width:100%;height:100%;min-height:220px;"></div>
{{ trend_data|json_script:"trend-data-json" }}
<script>
(function() {
    function init() {
        var el = document.getElementById('training-trend-render');
        if (!el || typeof echarts === 'undefined') return;
        var chart = echarts.init(el);
        var raw = document.getElementById('trend-data-json');
        var trendData = raw ? JSON.parse(raw.textContent) : [];

        var weeks = trendData.map(function(item) {
            if (item.week) {
                var d = new Date(item.week);
                return d.toLocaleDateString('es-CO', { month: 'short', day: 'numeric' });
            }
            return '';
        });
        var counts = trendData.map(function(item) { return item.count; });

        chart.setOption({
            tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
            grid: { left: '3%', right: '4%', bottom: '15%', containLabel: true },
            xAxis: { type: 'category', data: weeks, axisLabel: { rotate: 45, fontSize: 10 } },
            yAxis: { type: 'value', name: 'Completados', minInterval: 1 },
            series: [{
                name: 'Completados por semana',
                type: 'bar',
                data: counts,
                itemStyle: { color: '#3b82f6', borderRadius: [4, 4, 0, 0] },
                emphasis: { itemStyle: { color: '#2563eb' } }
            }]
        });
        window.addEventListener('resize', function() { chart.resize(); });
    }
    if (typeof echarts !== 'undefined') { init(); }
    else { document.addEventListener('echarts:ready', init); }
})();
</script>
