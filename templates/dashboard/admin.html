{% extends "base/dashboard.html" %}

{% block page_title %}Panel de Administraci贸n{% endblock %}
{% block page_description %}
<p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
    Resumen general del sistema de formaci贸n
</p>
{% endblock %}

{% block dashboard_content %}
<div class="space-y-6">
    <!-- Stats Cards Row -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"
         hx-get="{% url 'dashboard:stats' %}"
         hx-trigger="load"
         hx-swap="innerHTML">
        <!-- Loading placeholder -->
        {% for i in "1234" %}
        <div class="card bg-base-100 shadow animate-pulse">
            <div class="card-body">
                <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-2"></div>
                <div class="h-8 bg-gray-200 dark:bg-gray-700 rounded w-3/4"></div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Compliance Chart -->
        <div class="card bg-base-100 shadow">
            <div class="card-body">
                <h3 class="card-title text-lg">Cumplimiento de Formaci贸n</h3>
                <div id="compliance-chart"
                     hx-get="{% url 'dashboard:compliance-chart' %}"
                     hx-trigger="load"
                     hx-swap="innerHTML"
                     class="h-64">
                    <div class="flex items-center justify-center h-full">
                        <span class="loading loading-spinner loading-lg"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Training Trend Chart -->
        <div class="card bg-base-100 shadow">
            <div class="card-body">
                <h3 class="card-title text-lg">Tendencia de Capacitaci贸n</h3>
                <div id="training-trend-chart"
                     hx-get="{% url 'dashboard:training-trend' %}"
                     hx-trigger="load"
                     hx-swap="innerHTML"
                     class="h-64">
                    <div class="flex items-center justify-center h-full">
                        <span class="loading loading-spinner loading-lg"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tables Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Expiring Certifications -->
        <div class="card bg-base-100 shadow">
            <div class="card-body">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="card-title text-lg">Certificaciones por Vencer</h3>
                    <a href="{% url 'certifications:list' %}?status=expiring" class="btn btn-ghost btn-sm">
                        Ver todas
                    </a>
                </div>
                <div hx-get="{% url 'dashboard:expiring-certs' %}"
                     hx-trigger="load"
                     hx-swap="innerHTML">
                    <div class="flex items-center justify-center h-32">
                        <span class="loading loading-spinner loading-md"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overdue Assignments -->
        <div class="card bg-base-100 shadow">
            <div class="card-body">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="card-title text-lg">Asignaciones Vencidas</h3>
                    <a href="{% url 'learning_paths:assignments' %}?status=overdue" class="btn btn-ghost btn-sm">
                        Ver todas
                    </a>
                </div>
                <div hx-get="{% url 'dashboard:overdue-assignments' %}"
                     hx-trigger="load"
                     hx-swap="innerHTML">
                    <div class="flex items-center justify-center h-32">
                        <span class="loading loading-spinner loading-md"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="card bg-base-100 shadow">
        <div class="card-body">
            <div class="flex justify-between items-center mb-4">
                <h3 class="card-title text-lg">Actividad Reciente</h3>
                <div class="flex gap-2">
                    <select class="select select-bordered select-sm"
                            hx-get="{% url 'dashboard:recent-activity' %}"
                            hx-trigger="change"
                            hx-target="#activity-list"
                            name="filter">
                        <option value="all">Todas</option>
                        <option value="enrollments">Inscripciones</option>
                        <option value="completions">Completados</option>
                        <option value="certifications">Certificaciones</option>
                    </select>
                </div>
            </div>
            <div id="activity-list"
                 hx-get="{% url 'dashboard:recent-activity' %}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="flex items-center justify-center h-32">
                    <span class="loading loading-spinner loading-md"></span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
<script>
    // Initialize charts after HTMX loads content
    document.body.addEventListener('htmx:afterSwap', function(evt) {
        if (evt.detail.target.id === 'compliance-chart') {
            initComplianceChart();
        }
        if (evt.detail.target.id === 'training-trend-chart') {
            initTrainingTrendChart();
        }
    });
</script>
{% endblock %}
